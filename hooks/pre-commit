#!/bin/bash
# Git pre-commit hook for Komando
# This script runs before every commit to ensure code quality

set -e

echo "ğŸ” Running pre-commit checks..."

# Check if we're in the git repository root
if [ ! -d .git ]; then
    echo "Error: Not in git repository root"
    exit 1
fi

# 1. Run rustfmt
echo ""
echo "ğŸ“ Checking code formatting with rustfmt..."
if ! cargo fmt --all -- --check; then
    echo "âŒ Code formatting check failed!"
    echo "   Run: cargo fmt --all"
    exit 1
fi
echo "âœ… Formatting check passed"

# 2. Run clippy
echo ""
echo "ğŸ” Running clippy lints..."
if ! cargo clippy --all-targets --all-features; then
    echo "âŒ Clippy found issues!"
    echo "   Fix warnings or run: cargo clippy --fix"
    exit 1
fi
echo "âœ… Clippy passed"

# 3. Run tests (standard features only for speed)
echo ""
echo "ğŸ§ª Running tests..."
if ! cargo test --quiet; then
    echo "âŒ Tests failed!"
    exit 1
fi
echo "âœ… Tests passed"

# 4. Check that it builds
echo ""
echo "ğŸ”¨ Checking build..."
if ! cargo check --all-targets --all-features --quiet; then
    echo "âŒ Build check failed!"
    exit 1
fi
echo "âœ… Build check passed"

echo ""
echo "âœ¨ All pre-commit checks passed!"
echo ""
